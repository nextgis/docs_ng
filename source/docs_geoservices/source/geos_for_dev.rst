.. _nggeos_pkk_dev:


Сервисы Публичной кадастровой карты Росреестра, дополнение для разработчиков
==========================================================================

Общая информация
------------------

.. important::
   Данный инструмент доступен только владельцам `плана Premium <https://nextgis.ru/nextgis-com/plans>`_.

Сервисы NextGIS GeoServices PKK могут быть использованы программно посредством API и соответствующих запросов.

.. _nggeos_pkk_data_type:

Типы данных
----------------

Возможно получение данных по следующим типам (type) объектов:

* 1 - parcels - Земельные участки. Пример кадастрового номера: 40:7:122101:5
* 2 - units - Кадастровые кварталы. Пример кадастрового номера: 40:7:120803
* 4 - area - Кадастровые округа. Пример кадастрового номера: 40
* 5 - buildings - объекты капитального строительства. Пример кадастрового номера: 40:7:120702:175
* 10 - restricted zones - Зоны с особыми условиями использования территорий (ЗОУИТ). Пример кадастрового номера: 50:32-6.208

.. _nggeos_pkk_limits:

Что является запросом и лимиты
--------------------------------

Установленный по умолчанию лимит количества запросов на `команду <https://docs.nextgis.ru/docs_ngcom/source/create.html#ngcom-team-management>`_ - 1050 / час (25 000 / сутки)
В него входят:

- Запросы к тайлам. Учитываются только те случаи, когда мы отдали тайл, а не ошибку.
- Запросы за получением атрибутов (поиск по номеру и по местоположению).

Посмотреть текущую статистику запросов можно в дашборде по ссылке https://geoservices.nextgis.com/dashboard.

Статистика обновляется 1 раз в час.

.. figure:: _static/dashboard.png
   :name: dashboard
   :align: center
   :width: 20cm

   Дашборд со статистикой по запросам

.. _nggeos_pkk_cors_origins:

CORS Origins
-------------

Для веб-запросов - необходимо установить разрешенные адреса. 

* Войдите под своей учетной записью на geoservices.nextgis.com
* Зайдите в свой профиль. Найдите раздел Origins
* Нажмите New и введите адрес, который необходимо разрешить.
* Нажмите ОК
* Нажмите Update

.. _nggeos_pkk_example:

Примеры
-------

Реализация использования сервиса на Python.

Запрос участка (ОКС - объекта капитального строительства) по точке с координатами.

.. code-block:: bash
    
    import requests
    
    url = 'https://geoservices.nextgis.com/pkk/features/by_pos?apikey=YOUR-API-KEY&lat=55.67927298459276&lon=37.591867175551606&types=5'
    
    resp = requests.get(url)
    data = resp.json()
    print(data['features'][0])

Ответ

.. code-block:: bash

   {'type': 'Feature', 'geometry': {'type': 'Polygon', 'coordinates': [[[37.591821, 55.679316], [37.591823, 55.679316], [37.591823, 55.679315], [37.591826, 55.679315], [37.591826, 55.679314], [37.59183, 55.679314], [37.59183, 55.679313], [37.591833, 55.679313], [37.591833, 55.679312], [37.591837, 55.679312], [37.591837, 55.679311], [37.59184, 55.679311], [37.59184, 55.67931], [37.591843, 55.67931], [37.591843, 55.679309], [37.591847, 55.679309], [37.591847, 55.679308], [37.59185, 55.679308], [37.59185, 55.679307], [37.591854, 55.679307], [37.591854, 55.679306], [37.591857, 55.679306], [37.591857, 55.679305], [37.591861, 55.679305], [37.591861, 55.679304], [37.591864, 55.679304], [37.591864, 55.679303], [37.591868, 55.679303], [37.591868, 55.679302], [37.591871, 55.679302], [37.591871, 55.679301], [37.591874, 55.679301], [37.591874, 55.6793], [37.591878, 55.6793], [37.591878, 55.679299], [37.591881, 55.679299], [37.591881, 55.679298], [37.591885, 55.679298], [37.591885, 55.679297], [37.591888, 55.679297], [37.591888, 55.679296], [37.591892, 55.679296], [37.591892, 55.679295], [37.591895, 55.679295], [37.591895, 55.679294], [37.591899, 55.679294], [37.591899, 55.679293], [37.591902, 55.679293], [37.591902, 55.679292], [37.591906, 55.679292], [37.591906, 55.679291], [37.591909, 55.679291], [37.591909, 55.67929], [37.591912, 55.67929], [37.591912, 55.679289], [37.591916, 55.679289], [37.591916, 55.679288], [37.591919, 55.679288], [37.591919, 55.679287], [37.591923, 55.679287], [37.591923, 55.679286], [37.591926, 55.679286], [37.591926, 55.679285], [37.59193, 55.679285], [37.59193, 55.679284], [37.591933, 55.679284], [37.591933, 55.679283], [37.591932, 55.679283], [37.591932, 55.679282], [37.591931, 55.679282], [37.591931, 55.679281], [37.59193, 55.679281], [37.59193, 55.67928], [37.591929, 55.67928], [37.591929, 55.679279], [37.591928, 55.679279], [37.591928, 55.679278], [37.591927, 55.679278], [37.591927, 55.679276], [37.591926, 55.679276], [37.591926, 55.679275], [37.591925, 55.679275], [37.591925, 55.679274], [37.591924, 55.679274], [37.591924, 55.679273], [37.591923, 55.679273], [37.591923, 55.679272], [37.591922, 55.679272], [37.591922, 55.679271], [37.591921, 55.679271], [37.591921, 55.67927], [37.59192, 55.67927], [37.59192, 55.679269], [37.591919, 55.679269], [37.591919, 55.679268], [37.591918, 55.679268], [37.591918, 55.679266], [37.591917, 55.679266], [37.591917, 55.679265], [37.591916, 55.679265], [37.591916, 55.679264], [37.591915, 55.679264], [37.591915, 55.679263], [37.591914, 55.679263], [37.591914, 55.679262], [37.591913, 55.679262], [37.591913, 55.679261], [37.591912, 55.679261], [37.591912, 55.67926], [37.591911, 55.67926], [37.591911, 55.679259], [37.59191, 55.679259], [37.59191, 55.679258], [37.591909, 55.679258], [37.591909, 55.679256], [37.591908, 55.679256], [37.591908, 55.679255], [37.591907, 55.679255], [37.591907, 55.679254], [37.591906, 55.679254], [37.591906, 55.679253], [37.591905, 55.679253], [37.591905, 55.679252], [37.591904, 55.679252], [37.591904, 55.679251], [37.591903, 55.679251], [37.591903, 55.67925], [37.591902, 55.67925], [37.591902, 55.679249], [37.591901, 55.679249], [37.591901, 55.679248], [37.5919, 55.679248], [37.5919, 55.679246], [37.591899, 55.679246], [37.591899, 55.679245], [37.591898, 55.679245], [37.591898, 55.679244], [37.591897, 55.679244], [37.591897, 55.679243], [37.591896, 55.679243], [37.591896, 55.679242], [37.591895, 55.679242], [37.591895, 55.679241], [37.591894, 55.679241], [37.591894, 55.67924], [37.591893, 55.67924], [37.591893, 55.679239], [37.591892, 55.679239], [37.591892, 55.679238], [37.591891, 55.679238], [37.591891, 55.679236], [37.59189, 55.679236], [37.59189, 55.679235], [37.591889, 55.679235], [37.591889, 55.679234], [37.591888, 55.679234], [37.591888, 55.679233], [37.591885, 55.679233], [37.591885, 55.679234], [37.591882, 55.679234], [37.591882, 55.679235], [37.591878, 55.679235], [37.591878, 55.679236], [37.591875, 55.679236], [37.591875, 55.679237], [37.591871, 55.679237], [37.591871, 55.679238], [37.591868, 55.679238], [37.591868, 55.679239], [37.591865, 55.679239], [37.591865, 55.67924], [37.591861, 55.67924], [37.591861, 55.679241], [37.591858, 55.679241], [37.591858, 55.679242], [37.591854, 55.679242], [37.591854, 55.679243], [37.591851, 55.679243], [37.591851, 55.679244], [37.591847, 55.679244], [37.591847, 55.679245], [37.591844, 55.679245], [37.591844, 55.679246], [37.59184, 55.679246], [37.59184, 55.679247], [37.591837, 55.679247], [37.591837, 55.679248], [37.591833, 55.679248], [37.591833, 55.679249], [37.59183, 55.679249], [37.59183, 55.67925], [37.591827, 55.67925], [37.591827, 55.679251], [37.591823, 55.679251], [37.591823, 55.679252], [37.59182, 55.679252], [37.59182, 55.679253], [37.591816, 55.679253], [37.591816, 55.679254], [37.591813, 55.679254], [37.591813, 55.679255], [37.591809, 55.679255], [37.591809, 55.679256], [37.591806, 55.679256], [37.591806, 55.679257], [37.591802, 55.679257], [37.591802, 55.679258], [37.591799, 55.679258], [37.591799, 55.679259], [37.591796, 55.679259], [37.591796, 55.67926], [37.591792, 55.67926], [37.591792, 55.679261], [37.591789, 55.679261], [37.591789, 55.679262], [37.591785, 55.679262], [37.591785, 55.679263], [37.591782, 55.679263], [37.591782, 55.679264], [37.591778, 55.679264], [37.591778, 55.679265], [37.591776, 55.679265], [37.591776, 55.679266], [37.591777, 55.679266], [37.591777, 55.679267], [37.591778, 55.679267], [37.591778, 55.679268], [37.591779, 55.679268], [37.591779, 55.67927], [37.59178, 55.67927], [37.59178, 55.679271], [37.591781, 55.679271], [37.591781, 55.679272], [37.591782, 55.679272], [37.591782, 55.679273], [37.591783, 55.679273], [37.591783, 55.679274], [37.591784, 55.679274], [37.591784, 55.679275], [37.591785, 55.679275], [37.591785, 55.679276], [37.591786, 55.679276], [37.591786, 55.679277], [37.591787, 55.679277], [37.591787, 55.679278], [37.591788, 55.679278], [37.591788, 55.679279], [37.591789, 55.679279], [37.591789, 55.679281], [37.59179, 55.679281], [37.59179, 55.679282], [37.591791, 55.679282], [37.591791, 55.679283], [37.591792, 55.679283], [37.591792, 55.679284], [37.591793, 55.679284], [37.591793, 55.679285], [37.591794, 55.679285], [37.591794, 55.679286], [37.591795, 55.679286], [37.591795, 55.679287], [37.591796, 55.679287], [37.591796, 55.679288], [37.591797, 55.679288], [37.591797, 55.679289], [37.591798, 55.679289], [37.591798, 55.679291], [37.591799, 55.679291], [37.591799, 55.679292], [37.5918, 55.679292], [37.5918, 55.679293], [37.591801, 55.679293], [37.591801, 55.679294], [37.591802, 55.679294], [37.591802, 55.679295], [37.591803, 55.679295], [37.591803, 55.679296], [37.591804, 55.679296], [37.591804, 55.679297], [37.591805, 55.679297], [37.591805, 55.679298], [37.591806, 55.679298], [37.591806, 55.679299], [37.591807, 55.679299], [37.591807, 55.679301], [37.591808, 55.679301], [37.591808, 55.679302], [37.591809, 55.679302], [37.591809, 55.679303], [37.59181, 55.679303], [37.59181, 55.679304], [37.591811, 55.679304], [37.591811, 55.679305], [37.591812, 55.679305], [37.591812, 55.679306], [37.591813, 55.679306], [37.591813, 55.679307], [37.591814, 55.679307], [37.591814, 55.679308], [37.591815, 55.679308], [37.591815, 55.679309], [37.591816, 55.679309], [37.591816, 55.67931], [37.591817, 55.67931], [37.591817, 55.679312], [37.591818, 55.679312], [37.591818, 55.679313], [37.591819, 55.679313], [37.591819, 55.679314], [37.59182, 55.679314], [37.59182, 55.679315], [37.591821, 55.679315], [37.591821, 55.679316]]]}, 'properties': {'cn': '77:06:0004003:1069', 'fp': 200, 'id': '77:6:4003:1069', 'name': 'здание', 'depth': None, 'rayon': '77:6', 'floors': '4', 'height': None, 'spread': None, 'volume': None, 'address': 'Российская Федерация, город Москва, вн.тер.г. муниципальный округ Котловка, улица Большая Черёмушкинская, Дом 25, Строение 77', 'kvartal': '77:6:4003', 'purpose': '204001000000', 'statecd': '01', 'area_dev': None, 'cad_cost': 38406058.38, 'cad_unit': '383', 'oks_type': 'building', 'reg_date': '26.05.2012', 'area_type': '002', 'area_unit': '055', 'date_cost': '01.01.2023', 'year_used': 1975.0, 'area_value': 666.3, 'kvartal_cn': '77:06:0004003', 'year_built': 1975.0, 'purpose_name': 'Нежилое', 'area_dev_type': '002', 'area_dev_unit': '055', 'cad_record_date': None, 'application_date': '01.01.2024', 'cc_date_approval': None, 'cc_date_entering': '09.12.2023', 'underground_floors': None, 'type': 5, 'extent_parent': {}, 'center': {'x': 4184706.0801692894, 'y': 7494831.407861941}, 'extent': {'xmax': 4184714.82975462, 'xmin': 4184697.32418952, 'ymax': 7494839.597222454, 'ymin': 7494823.21961224}}}

Запрос участка (ОКС - объекта капитального строительства) по кадастровому номеру.

.. code-block:: bash
    
    import requests

    url = 'https://geoservices.nextgis.com/pkk/features/by_id?apikey=YOUR-API-KEY&cache=include&type=5&id=77:06:0004003:1069'

    resp = requests.get(url)
    data = resp.json()
    print(data['features'][0])

Ответ должен быть идентичен ответу из примера выше.
